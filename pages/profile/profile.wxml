<!--profile.wxml-->
<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ä¸ªäººä¸­å¿ƒé¡µé¢ -->
  <view wx:else>
    <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
    <view class="user-card">
      <view class="avatar-section">
        <image 
          class="avatar" 
          src="{{userInfo.avatarUrl || 'https://via.placeholder.com/128x128?text=å¤´åƒ'}}" 
          mode="aspectFill"
          bindtap="chooseAvatar"
        />
        <text class="avatar-upload">ç‚¹å‡»æ›´æ¢</text>
      </view>
      <view class="user-info">
        <view class="user-header">
          <text class="username">{{userInfo.nickName || 'æœªè®¾ç½®æ˜µç§°'}}</text>
          <view class="level-badge" style="background-color: {{levelInfo?.color || '#999999'}};">
            <text class="level-icon">{{levelInfo?.icon || 'ğŸŒ±'}}</text>
            <text class="level-text">{{levelInfo?.name || 'æ¼«æ¸¸æ–°æ‰‹'}}</text>
            <text class="level-number">Lv{{levelInfo?.level || 1}}</text>
          </view>
        </view>
        <text class="user-signature">{{userInfo.signature || 'æœªè®¾ç½®ç­¾å'}}</text>
        <text class="user-city">{{userInfo.city || 'æœªè®¾ç½®åŸå¸‚'}}</text>
        
        <!-- ç­‰çº§è¿›åº¦æ¡ -->
        <view class="level-progress">
          <view class="progress-info">
            <text class="progress-text">ç»éªŒå€¼: {{levelInfo?.exp || 0}} / {{levelInfo?.nextLevelExp || 100}}</text>
            <text class="progress-percent">{{levelInfo?.progress || 0}}%</text>
          </view>
          <view class="progress-bar">
            <view 
              class="progress-fill" 
              style="width: {{levelInfo?.progress || 0}}%; background-color: {{levelInfo?.color || '#999999'}};"
            ></view>
          </view>
        </view>
      </view>
    </view>

    <!-- æˆ‘çš„æ´»åŠ¨ -->
    <view class="card">
      <text class="section-title">æˆ‘çš„æ´»åŠ¨</text>
      <view class="activity-stats">
        <view class="stat-item">
          <text class="stat-number">{{stats.created || 0}}</text>
          <text class="stat-label">åˆ›å»ºçš„æ´»åŠ¨</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{stats.joined || 0}}</text>
          <text class="stat-label">å‚ä¸çš„æ´»åŠ¨</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{stats.completed || 0}}</text>
          <text class="stat-label">å®Œæˆçš„æ´»åŠ¨</text>
        </view>
      </view>
    </view>

    <!-- æˆå°±é¢æ¿ -->
    <view class="card">
      <text class="section-title">æˆå°±é¢æ¿</text>
      <view class="achievement-stats">
        <view class="achievement-item">
          <text class="achievement-icon">ğŸ“</text>
          <text class="achievement-number">{{achievements.checkins || 0}}</text>
          <text class="achievement-label">æ€»æ‰“å¡æ¬¡æ•°</text>
        </view>
        <view class="achievement-item">
          <text class="achievement-icon">ğŸ†</text>
          <text class="achievement-number">{{achievements.badges || 0}}</text>
          <text class="achievement-label">è·å¾—å¾½ç« </text>
        </view>
        <view class="achievement-item">
          <text class="achievement-icon">ğŸŒŸ</text>
          <text class="achievement-number">{{achievements.ranking || 0}}</text>
          <text class="achievement-label">æ’è¡Œæ¦œæ’å</text>
        </view>
      </view>
      <view class="achievement-list">
        <block wx:for="{{recentAchievements}}" wx:key="index">
          <view class="achievement-card">
            <text class="achievement-card-icon">{{item.icon}}</text>
            <view class="achievement-card-content">
              <text class="achievement-card-title">{{item.title}}</text>
              <text class="achievement-card-desc">{{item.description}}</text>
              <text class="achievement-card-date">{{item.date}}</text>
            </view>
          </view>
        </block>
        <view wx:if="recentAchievements.length === 0" class="empty-achievements">
          <text class="empty-text">æš‚æ— æˆå°±ï¼Œç»§ç»­åŠ æ²¹ï¼</text>
        </view>
      </view>
    </view>

    <!-- ä¸ªäººèµ„æ–™ç¼–è¾‘ -->
    <view class="card">
      <text class="section-title">ä¸ªäººèµ„æ–™</text>
      <view class="form-item">
        <text class="form-label">æ˜µç§°</text>
        <input 
          class="form-input" 
          placeholder="è¯·è¾“å…¥æ˜µç§°" 
          value="{{userInfo.nickName}}" 
          bindinput="onNickNameChange"
        />
      </view>
      <view class="form-item">
        <text class="form-label">ç­¾å</text>
        <textarea 
          class="form-textarea" 
          placeholder="è¯·è¾“å…¥ä¸ªäººç­¾å" 
          value="{{userInfo.signature}}" 
          bindinput="onSignatureChange"
        />
      </view>
      <view class="form-item">
        <text class="form-label">åŸå¸‚</text>
        <input 
          class="form-input" 
          placeholder="è¯·è¾“å…¥æ‰€åœ¨åŸå¸‚" 
          value="{{userInfo.city}}" 
          bindinput="onCityChange"
        />
      </view>
      <button 
        class="save-btn" 
        bindtap="saveProfile"
      >
        ä¿å­˜ä¿®æ”¹
      </button>
    </view>

    <!-- å…¶ä»–åŠŸèƒ½ -->
    <view class="card">
      <text class="section-title">å…¶ä»–</text>
      <view class="menu-list">
        <view class="menu-item" bindtap="goToCheckinRecords">
          <text class="menu-text">æ‰“å¡è®°å½•</text>
          <text class="menu-arrow">â†’</text>
        </view>
        <view class="menu-item" bindtap="goToAbout">
          <text class="menu-text">å…³äºæˆ‘ä»¬</text>
          <text class="menu-arrow">â†’</text>
        </view>
        <view class="menu-item" bindtap="goToSettings">
          <text class="menu-text">è®¾ç½®</text>
          <text class="menu-arrow">â†’</text>
        </view>
        <view wx:if="{{userInfo.admin}}" class="menu-item" bindtap="goToAdmin">
          <text class="menu-text">ç®¡ç†å‘˜ä¸­å¿ƒ</text>
          <text class="menu-arrow">â†’</text>
        </view>
      </view>
    </view>
  </view>
</view>