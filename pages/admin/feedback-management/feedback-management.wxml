<!-- feedback-management.wxml -->
<view class="feedback-management-container">
  <view class="feedback-header">
    <text class="feedback-title">åé¦ˆç®¡ç†</text>
    <text class="feedback-subtitle">æŸ¥çœ‹å’Œå¤„ç†ç”¨æˆ·åé¦ˆ</text>
  </view>

  <view class="status-filter">
    <view 
      class="filter-item {{activeFilter === '' ? 'active' : ''}}"
      bindtap="setFilter"
      data-filter=""
    >
      <text class="filter-text">å…¨éƒ¨</text>
    </view>
    <view 
      class="filter-item {{activeFilter === 'pending' ? 'active' : ''}}"
      bindtap="setFilter"
      data-filter="pending"
    >
      <text class="filter-text">æœªå¤„ç†</text>
      <view wx:if="unreadCount > 0" class="unread-badge">{{unreadCount}}</view>
    </view>
    <view 
      class="filter-item {{activeFilter === 'read' ? 'active' : ''}}"
      bindtap="setFilter"
      data-filter="read"
    >
      <text class="filter-text">å·²è¯»</text>
    </view>
    <view 
      class="filter-item {{activeFilter === 'replied' ? 'active' : ''}}"
      bindtap="setFilter"
      data-filter="replied"
    >
      <text class="filter-text">å·²å›å¤</text>
    </view>
  </view>

  <view class="feedback-list">
    <block wx:if="feedbackList.length > 0">
      <view 
        wx:for="{{feedbackList}}" 
        wx:key="{{item._id}}"
        class="feedback-item {{item.status === 'pending' ? 'unread' : ''}}"
        bindtap="viewFeedbackDetail"
        data-id="{{item._id}}"
      >
        <view class="feedback-header-info">
          <text class="user-name">{{item.userName}}</text>
          <text class="feedback-time">{{formatTime(item.createdAt)}}</text>
          <view class="status-badge {{item.status}}">
            {{getStatusText(item.status)}}
          </view>
        </view>
        <text class="feedback-content">{{item.content}}</text>
        <view wx:if="item.contact" class="feedback-contact">
          <text class="contact-label">è”ç³»æ–¹å¼ï¼š</text>
          <text class="contact-value">{{item.contact}}</text>
        </view>
        <view wx:if="item.reply" class="feedback-reply">
          <text class="reply-label">å›å¤ï¼š</text>
          <text class="reply-content">{{item.reply}}</text>
        </view>
      </view>
    </block>
    <block wx:else>
      <view class="empty-state">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">æš‚æ— åé¦ˆ</text>
      </view>
    </block>
  </view>

  <view wx:if="showPagination" class="pagination">
    <text class="pagination-info">
      ç¬¬ {{currentPage}} é¡µï¼Œå…± {{totalPages}} é¡µ
    </text>
    <view class="pagination-buttons">
      <button 
        class="pagination-btn {{currentPage === 1 ? 'disabled' : ''}}"
        bindtap="changePage"
        data-page="{{currentPage - 1}}"
        disabled="{{currentPage === 1}}"
      >
        ä¸Šä¸€é¡µ
      </button>
      <button 
        class="pagination-btn {{currentPage === totalPages ? 'disabled' : ''}}"
        bindtap="changePage"
        data-page="{{currentPage + 1}}"
        disabled="{{currentPage === totalPages}}"
      >
        ä¸‹ä¸€é¡µ
      </button>
    </view>
  </view>

  <!-- åé¦ˆè¯¦æƒ…å¼¹çª— -->
  <view wx:if="showDetail" class="detail-modal">
    <view class="detail-content">
      <view class="detail-header">
        <text class="detail-title">åé¦ˆè¯¦æƒ…</text>
        <text class="detail-close" bindtap="closeDetail">Ã—</text>
      </view>
      <view class="detail-body">
        <view class="detail-item">
          <text class="detail-label">ç”¨æˆ·ï¼š</text>
          <text class="detail-value">{{currentFeedback.userName}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æäº¤æ—¶é—´ï¼š</text>
          <text class="detail-value">{{formatTime(currentFeedback.createdAt)}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">åé¦ˆç±»å‹ï¼š</text>
          <text class="detail-value">{{getTypeText(currentFeedback.type)}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">è”ç³»æ–¹å¼ï¼š</text>
          <text class="detail-value">{{currentFeedback.contact || 'æ— '}}</text>
        </view>
        <view class="detail-item detail-content-item">
          <text class="detail-label">åé¦ˆå†…å®¹ï¼š</text>
          <text class="detail-content-text">{{currentFeedback.content}}</text>
        </view>
        <view wx:if="currentFeedback.reply" class="detail-item detail-content-item">
          <text class="detail-label">å›å¤å†…å®¹ï¼š</text>
          <text class="detail-content-text reply-text">{{currentFeedback.reply}}</text>
        </view>
      </view>
      <view class="detail-footer">
        <button 
          class="footer-btn secondary"
          bindtap="markAsRead"
          wx:if="currentFeedback.status === 'pending'"
        >
          æ ‡è®°å·²è¯»
        </button>
        <button 
          class="footer-btn primary"
          bindtap="showReplyModal"
          wx:if="currentFeedback.status !== 'replied'"
        >
          å›å¤åé¦ˆ
        </button>
        <button 
          class="footer-btn secondary"
          bindtap="closeDetail"
        >
          å…³é—­
        </button>
      </view>
    </view>
  </view>

  <!-- å›å¤å¼¹çª— -->
  <view wx:if="showReply" class="reply-modal">
    <view class="reply-content">
      <view class="reply-header">
        <text class="reply-title">å›å¤åé¦ˆ</text>
        <text class="reply-close" bindtap="closeReplyModal">Ã—</text>
      </view>
      <form bindsubmit="submitReply" class="reply-form">
        <textarea 
          class="reply-textarea" 
          placeholder="è¯·è¾“å…¥å›å¤å†…å®¹..." 
          placeholder-class="placeholder-text"
          name="reply"
          value="{{replyContent}}"
          bindinput="onReplyInput"
          maxlength="500"
        ></textarea>
        <text class="word-count">{{replyContent.length}}/500</text>
        <button 
          class="submit-btn" 
          form-type="submit"
          disabled="{{!replyContent.trim()}}"
          loading="{{submitting}}"
        >
          æäº¤å›å¤
        </button>
      </form>
    </view>
  </view>
</view>