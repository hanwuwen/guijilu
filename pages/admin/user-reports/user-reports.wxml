<!-- user-reports.wxml -->
<view class="container">
  <view class="header">
    <text class="header-title">用户举报管理</text>
    <text class="header-subtitle">处理用户提交的举报信息</text>
  </view>

  <view class="filter-bar">
    <view class="filter-item {{filterStatus === '' ? 'active' : ''}}" bindtap="setFilterStatus">
      <text>全部</text>
    </view>
    <view class="filter-item {{filterStatus === 'pending' ? 'active' : ''}}" bindtap="setFilterStatus" data-status="pending">
      <text>待处理</text>
    </view>
    <view class="filter-item {{filterStatus === 'processed' ? 'active' : ''}}" bindtap="setFilterStatus" data-status="processed">
      <text>已处理</text>
    </view>
    <view class="filter-item {{filterStatus === 'rejected' ? 'active' : ''}}" bindtap="setFilterStatus" data-status="rejected">
      <text>已驳回</text>
    </view>
  </view>

  <view class="report-list">
    <block wx:for="{{reports}}" wx:key="_id">
      <view class="report-item">
        <view class="report-header">
          <view class="report-info">
            <text class="report-type">{{getReportTypeText(item.type)}}</text>
            <text class="report-status {{item.status === 'pending' ? 'pending' : item.status === 'processed' ? 'processed' : 'rejected'}}">
              {{getStatusText(item.status)}}
            </text>
          </view>
          <text class="report-time">{{formatTime(item.createdAt)}}</text>
        </view>

        <view class="report-content">
          <view class="user-info">
            <text class="label">举报用户:</text>
            <text class="value">{{item.reporterInfo.nickname}}</text>
          </view>
          <view class="user-info">
            <text class="label">被举报用户:</text>
            <text class="value">{{item.reportedInfo.nickname}}</text>
          </view>
          <view class="report-reason">
            <text class="label">举报原因:</text>
            <text class="value">{{item.reason}}</text>
          </view>
          <view wx:if="{{item.contentInfo}}" class="content-info">
            <text class="label">被举报内容:</text>
            <text class="value">{{item.contentInfo.title || item.contentInfo.content}}</text>
          </view>
        </view>

        <view wx:if="{{item.status === 'pending'}}" class="report-actions">
          <button class="action-btn accept" bindtap="handleReport" data-id="{{item._id}}" data-action="accept">
            确认违规
          </button>
          <button class="action-btn reject" bindtap="handleReport" data-id="{{item._id}}" data-action="reject">
            驳回举报
          </button>
        </view>
        <view wx:else class="report-processed">
          <text class="processed-text">处理时间: {{formatTime(item.processedAt)}}</text>
          <text wx:if="{{item.processReason}}" class="processed-reason">处理原因: {{item.processReason}}</text>
        </view>
      </view>
    </block>
  </view>

  <view wx:if="{{reports.length === 0}}" class="empty-state">
    <text class="empty-text">暂无举报信息</text>
  </view>

  <view wx:if="{{loading}}" class="loading-state">
    <text class="loading-text">加载中...</text>
  </view>
</view>