<!--checkin.wxml-->
<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æ‰“å¡é¡µé¢ -->
  <view wx:else>
    <!-- æ‰“å¡åœ°ç‚¹ä¿¡æ¯ -->
    <view class="card">
      <text class="section-title">æ‰“å¡åœ°ç‚¹</text>
      <view class="checkpoint-info">
        <text class="checkpoint-name">{{checkpoint.name}}</text>
        <text class="checkpoint-desc">{{checkpoint.description}}</text>
        <text class="checkpoint-location">{{checkpoint.location.name}}</text>
        <text class="checkpoint-address">{{checkpoint.location.address}}</text>
      </view>
    </view>

    <!-- å½“å‰ä½ç½®ä¿¡æ¯ -->
    <view class="card">
      <text class="section-title">å½“å‰ä½ç½®</text>
      <view class="location-info">
        <text class="location-text">{{currentLocation.name || 'è·å–ä½ç½®ä¸­...'}}</text>
        <text class="location-address">{{currentLocation.address || ''}}</text>
        <view class="distance-info" wx:if="{{distance !== null}}">
          <text class="distance-text">è·ç¦»æ‰“å¡ç‚¹: {{distance}}ç±³</text>
          <text class="distance-status {{distance <= 500 ? 'valid' : 'invalid'}}">
            {{distance <= 500 ? 'âœ… è·ç¦»æœ‰æ•ˆ' : 'âŒ è·ç¦»è¿‡è¿œ'}}
          </text>
        </view>
      </view>
    </view>

    <!-- æ‰“å¡è¡¨å• -->
    <view class="card">
      <text class="section-title">æ‰“å¡è®°å½•</text>
      <textarea 
        class="checkin-note" 
        placeholder="å†™ä¸‹ä½ çš„æ‰“å¡å¿ƒå¾—..." 
        value="{{checkinNote}}"
        bindinput="onNoteInput"
      />
      
      <!-- å›¾ç‰‡ä¸Šä¼  -->
      <view class="upload-section">
        <text class="upload-title">æ·»åŠ å›¾ç‰‡ (æœ€å¤š3å¼ )</text>
        <view class="upload-list">
          <block wx:for="{{checkinImages}}" wx:key="index">
            <view class="upload-item">
              <image class="upload-image" src="{{item}}" mode="aspectFill" />
              <view class="upload-remove" bindtap="removeImage" data-index="{{index}}">Ã—</view>
            </view>
          </block>
          <view 
            wx:if="{{checkinImages.length < 3}}" 
            class="upload-add" 
            bindtap="chooseImage"
          >
            <text class="upload-add-icon">+</text>
            <text class="upload-add-text">æ·»åŠ å›¾ç‰‡</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="bottom-bar">
      <button 
        class="checkin-btn" 
        bindtap="submitCheckin" 
        disabled="{{!canCheckin}}"
      >
        {{canCheckin ? 'ç«‹å³æ‰“å¡' : 'è·ç¦»è¿‡è¿œï¼Œæ— æ³•æ‰“å¡'}}
      </button>
    </view>
  </view>

  <!-- æ‰“å¡æˆåŠŸåŠ¨ç”» -->
  <view wx:if="{{showSuccessAnimation}}" class="success-animation">
    <view class="success-container">
      <view class="success-icon">ğŸ“</view>
      <text class="success-title">æ‰“å¡æˆåŠŸï¼</text>
      <text class="success-subtitle">æ­å–œä½ å®Œæˆäº†è¿™ä¸ªæ‰“å¡ç‚¹</text>
      <!-- ç­‰çº§æå‡æç¤º -->
      <view class="success-level-info" wx:if="{{levelReward}}">
        <text class="level-reward-text">ğŸ è·å¾—ç»éªŒå€¼: +10</text>
        <text class="level-up-text" wx:if="{{levelReward.levelUp}}">
          ğŸ‰ æ­å–œå‡çº§ï¼
        </text>
        <text class="level-info-text" wx:if="{{levelReward.newLevel}}">
          å½“å‰ç­‰çº§: {{levelReward.newLevel.name}} Lv{{levelReward.newLevel.level}}
        </text>
      </view>
      <view class="success-confetti">
        <block wx:for="{{20}}" wx:key="index">
          <view class="confetti" style="--i: {{index}};"></view>
        </block>
      </view>
    </view>
  </view>
</view>